# NFS Trail Configuration

# NFS mounts to monitor
mounts:
  # Monitor all NFS mounts
  all: true

  # Or specify specific mount points (uncomment to use)
  # all: false
  # paths:
  #   - /mnt/nfs-storage
  #   - /data/shared

# UID/GID and operation filtering
filters:
  # Include specific UIDs (empty = all)
  include_uids: []

  # Exclude specific UIDs
  exclude_uids:
    - 0       # root
    - 65534   # nobody

  # UID ranges to include
  include_uid_ranges:
    - min: 1000
      max: 60000

  # UID ranges to exclude
  exclude_uid_ranges: []

  # Exclude specific operations (reduce noise)
  # Available: read, write, open, close, stat, chmod, chown, rename, delete, mkdir, rmdir, symlink, link, setxattr, truncate
  exclude_operations: []
  # Example to exclude stat operations:
  # exclude_operations:
  #   - stat

  # Include only specific operations (if set, only these are logged)
  include_operations: []
  # Example to only log security-relevant operations:
  # include_operations:
  #   - chmod
  #   - chown
  #   - delete
  #   - rename

# Event aggregation settings
aggregation:
  # Enable event aggregation
  enabled: true

  # Time window for grouping events (milliseconds)
  window_ms: 500

  # Max files to list individually before summarizing
  max_file_list: 10

  # Minimum events to trigger aggregation
  min_event_count: 3

# Output configuration
output:
  # Output type: file, stdout, journald
  type: stdout

  # File output settings (used when type=file)
  file:
    path: /var/log/nfs-trail/events.json
    # Rotate settings
    max_size_mb: 100
    max_backups: 10
    max_age_days: 30
    compress: true

  # ECS format compliance
  ecs:
    version: "8.17.0"
    # Additional ECS fields to include
    tags: ["nfs", "filesystem", "audit"]

# Performance tuning
performance:
  # Event channel buffer size (number of events)
  # Large buffer helps handle I/O bursts (e.g., ls -R, find, rsync)
  channel_buffer_size: 10000

  # Print processing statistics every N seconds (0 = disabled)
  stats_interval_sec: 0

  # Rate limiting (protects against event floods)
  # Maximum events per second to process (0 = unlimited)
  # Example: 50000 = allow 50K events/sec, drop excess
  max_events_per_sec: 0

  # Drop policy when buffer/rate limit exceeded
  # "oldest" - drop oldest events to make room for new (maintains recent history)
  # "newest" - drop new events when full (preserves existing data)
  drop_policy: "oldest"

  # Log warnings when events are dropped (important for audit trail)
  log_dropped_events: true

  # Log drop statistics every N seconds (0 = disabled)
  # Shows drop rate percentage for monitoring
  drop_stats_interval_sec: 30

  # User/group name cache settings
  cache:
    size: 10000          # Maximum entries in LRU cache
    ttl_seconds: 300     # 5 minutes

# Logging (daemon's own logs, not NFS events)
logging:
  level: info  # debug, info, warn, error
  output: stdout

# Prometheus metrics endpoint
metrics:
  # Enable Prometheus metrics HTTP endpoint
  enabled: false

  # Port for /metrics endpoint (Prometheus scraping)
  # Default: 9090
  port: 9090
